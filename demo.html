<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>interact Pad</title>
    <script src="http://g.tbcdn.cn/kissy/k/1.3.2/seed-min.js"></script>
    <link rel="stylesheet" type="text/css" href="./resource/demo.css">
</head>
<body> 
    <div class="container">
        <div class="left">

            <!--留出一个容器，供组件使用 -->
            <div class="canvasWrapper"> </div>
        </div>

        <div class="right">
            <h4>图层管理</h4>
            <table>
                <tr>
                    <td class="thumbImg"><img src="./resource/frame.png" /></td>
                    <td class="action act-active"><a class="frameAct" href="#">激活鼠标拖动交互</a></td>
                    <td class="action all_cancel" rowspan="3"><a class="all_cancel" href="#">退出交互</a></td>
                </tr>

                <tr>
                    <td class="thumbImg"><img src="./resource/dog.jpg" /></td>
                    <td class="action act-active"><a class="item1Act" href="#">激活鼠标拖动交互</a></td>
                </tr>

                <tr>
                    <td class="thumbImg"><img src="./resource/item2.png" /></td>
                    <td class="action act-active"><a class="item2Act" href="#">激活鼠标拖动交互</a></td>
                </tr>

                <tr>
                    <td class="action"><a class="set_rotate" href="#">设置旋转角度</a></td>
                    <td class="action"><a class="set_scale" href="#">设置缩放比例</a></td>
                    <td class="action"><a class="set_image" href="#">设置图片</a></td>
                </tr>

                <tr>
                    <td class="action act-cancel"><a class="getData" href="#">获取图像</a></td>
                    <td class="action act-active"><a class="getSingleInter" href="#">获取单层交互数据</a></td>
                    <td class="action act-cancel"><a class="getAllInter" href="#">获取全部交互数据</a></td>
                </tr>
            </table>
        </div>
        <div style="clear:both"> </div>

        <!-- <input type="file" id="J_selectFile" /> -->
    </div>

    <script type="text/javascript">

        /*调试模式，组件使用者无需使用*/
        var S = KISSY;
        S.Config.debug = true;
        if (S.Config.debug) {
            S.config({
                packages:[
                    {
                        name:"gallery/drawingPad/1.0",
                        path:"./",
                        charset:"utf-8",
                        ignorePackageNameInUri:true
                    }
                ]
            });
        }


        /*使用组件*/
        KISSY.use("gallery/drawingPad/1.0/index,node",function(S,DrawingPad,Node,F){
        // KISSY.use("gallery/drawingPad/1.0/index,node",function(S,DrawingPad,Node){
            S.ready(function(){

                //准备素材，受canvas安全限制，输出合成图片时只能使用同域素材，否则无法输出
                //可以考虑使用代理方案

                if( S.UA.ie <= 8){
                    //暂时性解决跨域问题，后续将通过flash跨域配置来解决
                    var frameEl =  "http://gtms01.alicdn.com/tps/i1/T14GxoXy8jXXaMrwve-700-430.png";
                    var itemEl1 = "http://gtms01.alicdn.com/tps/i1/T1oVxmXqVhXXb4HOvo-600-375.jpg";
                    var itemEl2 = "http://gtms01.alicdn.com/tps/i1/T1WuhmXD8hXXaeHbsb-100-100.png";
                    var proxyServer = "http://www.tmall.com/go/rgn/tbs-proxy.php?file=";  
                }else{
                    var frameEl = "./resource/frame.png"; 
                    var itemEl1 = "./resource/dog.jpg";   
                    var itemEl2 = "./resource/item2.png"; 
                    var proxyServer = "";                  
                }
                
                //初始化绘图板
                //若不使用proxy，直接置proxyPrefix:""
                var drawingPad = new DrawingPad({
                    height      : 430,
                    width       : 700,
                    wrapper     : S.get(".canvasWrapper"),
                    proxyPrefix : proxyServer // 百事项目："http://pepsi.tmall.com/usrimg?src=" 
                });

                //添加图层，添加顺序即是覆盖顺序
                var itemLayer = drawingPad.addLayer({
                    img      : itemEl1, //图层的图形素材，必须指定 
                    centerX  : 200,     //图片的中心x，可选，默认0
                    centerY  : 200,     //图片的中心y，可选，默认0
                    rotate   : 10,      //旋转角度,可选，默认0
                    scale    : 1,       //缩放比例，可选，默认0
                    cusClass : "myClass" //自定义样式
                }); //.render();

                //添加图层，添加顺序即是覆盖顺序
                var frameLayer = drawingPad.addLayer({
                    img   : frameEl
                }); //.render();

                //添加图层，添加顺序即是覆盖顺序
                var itemLayer2 = drawingPad.addLayer({
                    img : itemEl2
                }); //.render();

                Node.one(".item1Act").on("click",function(){
                    drawingPad.activeInteract(itemLayer);
                });

                Node.one(".item2Act").on("click",function(){
                    drawingPad.activeInteract(itemLayer2);
                });

                Node.one(".frameAct").on("click",function(){
                    drawingPad.activeInteract(frameLayer);
                });

                Node.one(".all_cancel").on("click",function(){
                    drawingPad.deactiveInteract();  //退出所有图层的交互模式
                });

                Node.one(".set_rotate").on("click",function(){
                    drawingPad.setLayerPara(itemLayer2,"rotate",180); //[-180,180]
                });

                Node.one(".set_scale").on("click",function(){
                    drawingPad.setLayerPara(itemLayer2,"scale",7); //大于0
                });

                Node.one(".set_image").on("click",function(){
                    drawingPad.setLayerPara(itemLayer,"img",frameEl);
                });

                //获取交互数据
                Node.one(".getSingleInter").on("click",function(){
                    var data = drawingPad.getLayerInfo(itemLayer);
                    console.log(data);
                });

                Node.one(".getAllInter").on("click",function(){
                    var data = drawingPad.getLayerInfo();
                    console.log(data);
                });

                //获取合并后的数据，并在新窗口中打开预览
                //这个功能会涉及代理功能的使用，请务必联系ＰＥ确认！
                Node.one(".getData").on("click",function(){
                    var data = drawingPad.getMergedData(function(data){
                        S.log(data);

                        if(S.UA.chrome){
                            window.open(data,"_blank");
                        }
                    },8000);
                    // alert(data);
                });

                // forDebug
                window.drawingPad = drawingPad;
                window.itemLayer  = itemLayer;
                window.frameLayer = frameLayer;
            });

        });

    </script>

    <style>
    /*全是demo中的style，可以删除*/
    <!--#include "/mods/demo.css"-->
    </style>